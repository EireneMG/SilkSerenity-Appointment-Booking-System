<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account Settings</title>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <link rel="stylesheet" href="../assets/css/mediaqueries.css" />
    <style>
      /* General Styles */
      body {
        font-family: "Arial", sans-serif;
        background-color: #f3d8cf;
        color: #2c2c2c;
        margin: 0;
        padding: 20px;
      }

      /* Password field styles */
      .password-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .password-section {
        margin-top: 20px;
      }

      #show-password {
        cursor: pointer;
        color: #007bff;
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="account-container">
      <!-- Header with Close Icon -->
      <div class="account-header">
        <h1>
          <i class="bi bi-person-circle" style="font-size: 3rem"></i
          >&nbsp;&nbsp;Account Settings
        </h1>
        <a href="home.html" class="close-icon" title="Go to Home">
          <i class="bi bi-x-circle"></i>
        </a>
      </div>

      <!-- Email Section -->
      <div class="section">
        <div class="section-title">Email Address</div>
        <p class="info-text">
          Your email address is <strong id="user-email">Loading...</strong>
          <span class="change-link" id="change-email">Change</span>
        </p>
      </div>

      <!-- Password Section -->
      <div class="section password-section">
        <div class="password-header">
          <div class="section-title">Password</div>
          <span id="show-password" class="change-link">Show</span>
        </div>
        <input
          type="password"
          placeholder="Current Password"
          id="password-input"
          value="******" 
        />
      </div>
      <!-- Appointments Section -->
      <div class="appointments-container">
        <div class="section-title">My Appointments</div>
        <table class="appointments-table">
            <thead>
                <tr>
                    <th>Service</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="appointmentsTableBody">
                <!-- Appointments will be loaded here -->
            </tbody>
        </table>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Fetch user data from the server
        fetch('get_account_data.php')
          .then(response => response.json())
          .then(data => {
            if (data.error) {
              alert('Error loading data: ' + data.error);
            } else {
              // Populate email and password fields
              document.getElementById('user-email').textContent = data.email;
              document.getElementById('password-input').value = '******'; // Show as masked initially

              // Store actual password to toggle later
              const actualPassword = data.password;

              // Handle password show/hide functionality
              document.getElementById('show-password').addEventListener('click', function () {
                const passwordInput = document.getElementById('password-input');
                if (passwordInput.type === 'password') {
                  passwordInput.type = 'text'; // Change to text to show password
                  document.getElementById('show-password').textContent = 'Hide'; // Change button text
                  passwordInput.value = actualPassword; // Display actual password
                } else {
                  passwordInput.type = 'password'; // Change back to password type
                  document.getElementById('show-password').textContent = 'Show'; // Change button text
                  passwordInput.value = '******'; // Mask password again
                }
              });
             // Populate appointments table
               const appointmentsTableBody = document.getElementById('appointmentsTableBody');
          if (data.appointments.length > 0) {
            data.appointments.forEach(appointment => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${appointment.service}</td>
                <td>${appointment.appointment_date}</td>
                <td>${appointment.appointment_time}</td>
                <td>${appointment.status}</td>
              `;
              appointmentsTableBody.appendChild(row);
            });
          } else {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td colspan="4" class="text-center">No appointments available</td>
            `;
            appointmentsTableBody.appendChild(row);
          }
        }
      })

          .catch(error => {
            console.error('Error loading data:', error);
          });
      });
    </script>
  </body>
</html>
